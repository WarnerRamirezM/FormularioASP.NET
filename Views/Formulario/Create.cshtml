@using WebApplication1.Models.ApiModels
@model WebApplication1.Models.Formulario

@{
    ViewData["Title"] = "Formulario de Admisión";
}

<h1>@ViewData["Title"]</h1>

<h4>Formulario de Admisión</h4>
<hr />

<form asp-action="Create" method="post" enctype="multipart/form-data"> <!--enctype para arcivos.jp.pdf-->
    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
    @if (ViewBag.Error != null)
    {
        <div class="alert alert-danger">
            @ViewBag.Error
        </div>
    }

    @if (ViewBag.ErrorArchivo != null)
    {
        <div class="alert alert-danger">
            @ViewBag.ErrorArchivo
        </div>
    }
    <div class="row formulario-container">
        <!-- Barra de Navegación -->
        <ul class="nav flex-column col-12 col-md-4 formulario-nav" id="pills-tab" role="tablist">
            <li class="nav-item active">
                <a href="#step-1" class="nav-link" id="pills-step-1-tab" data-toggle="pill" role="tab" aria-controls="pills-step-1" aria-selected="true">1 - Datos Personales/Carrera</a>
            </li>
            <li class="nav-item">
                <a href="#step-2" class="nav-link" id="pills-step-2-tab" data-toggle="pill">2 - Necesidades Educativas Especiales</a>
            </li>
            @* <li class="nav-item">
                <a href="#step-3" class="nav-link" data-toggle="pill">3 - Datos de Domicilio</a>
            </li> *@
            @*   <li class="nav-item"><a href="#step-4" class="nav-link" data-toggle="pill">4 - Datos Laborales</a></li>
            <li class="nav-item"><a href="#step-5" class="nav-link" data-toggle="pill">5 - Perfil Digital</a></li>
            <li class="nav-item"><a href="#step-6" class="nav-link" data-toggle="pill">6 - Perfil ingreso a la UNED</a></li>
            <li class="nav-item"><a href="#step-7" class="nav-link" data-toggle="pill">7 - Estudios Realizados</a></li>
            <li class="nav-item"><a href="#step-8" class="nav-link" data-toggle="pill">8 - Datos Idioma</a></li>
            <li class="nav-item"><a href="#step-9" class="nav-link" data-toggle="pill">9 - Otras Situaciones</a></li>
            <li class="nav-item"><a href="#step-10" class="nav-link" data-toggle="pill">10 - Informacion requisitos admisión</a></li> *@
        </ul>

        <!-- Columna 1: Datos Personales -->
        <div class="col-12 col-md-4 formulario-columna" id="columna-2">
            <div id="step-1">
                <div class="form-group">
                    <label asp-for="TipoIdentificacion"> Tipo Identificación</label>
                    <input asp-for="TipoIdentificacion" class="form-control" />
                    <span asp-validation-for="TipoIdentificacion" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="Identificacion"></label>
                    <input asp-for="Identificacion" class="form-control" />
                    <span asp-validation-for="Identificacion" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="Nombre"></label>
                    <input type="text" asp-for="Nombre" class="form-control" required/>
                    <span asp-validation-for="Nombre" class="text-danger"></span>
                </div>
            </div>
            <div class="form-group">
                <label asp-for="PrimerApellido">Primer Apellido</label>
                <input asp-for="PrimerApellido" class="form-control" />
                <span asp-validation-for="PrimerApellido" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="SegundoApellido">Segundo Apellido</label>
                <input asp-for="SegundoApellido" class="form-control" />
                <span asp-validation-for="SegundoApellido" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="Genero"></label>
                <input asp-for="Genero" class="form-control" />
                <span asp-validation-for="Genero" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="Nacionalidad"></label>
                <input asp-for="Nacionalidad" class="form-control" />
                <span asp-validation-for="Nacionalidad" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="FechaNacimiento">Fecha Nacimiento</label>
                <input asp-for="FechaNacimiento" class="form-control" />
                <span asp-validation-for="FechaNacimiento" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="EstadoCivil">Estado Civil</label>
                <input asp-for="EstadoCivil" class="form-control" />
                <span asp-validation-for="EstadoCivil" class="text-danger"></span>
            </div>
        </div>

        <!-- Columna 2: Contacto -->
        <div class="col-12 col-md-4 formulario-columna" id="columna-3">
            <div class="form-group">
                <label asp-for="TelefonoPrincipal">Teléfono Principal</label>
                <input asp-for="TelefonoPrincipal" class="form-control" />
                <span asp-validation-for="TelefonoPrincipal" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="TelefonoSecundario">Teléfono Secundario</label>
                <input asp-for="TelefonoSecundario" class="form-control" />
                <span asp-validation-for="TelefonoSecundario" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="Fax"></label>
                <input asp-for="Fax" class="form-control" />
                <span asp-validation-for="Fax" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="CorreoElectronico">Correo Electrónico</label>
                <input asp-for="CorreoElectronico" class="form-control" />
                <span asp-validation-for="CorreoElectronico" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="CorreoElectronicoSecundario">Correo Electrónico Secundario</label>
                <input asp-for="CorreoElectronicoSecundario" class="form-control" />
                <span asp-validation-for="CorreoElectronicoSecundario" class="text-danger"></span>
            </div>

            <div class="form-group form-check">
                <label class="form-check-label">
                    <input class="form-check-input" asp-for="Indigena" />
                    @Html.DisplayNameFor(model => model.Indigena)
                </label>
            </div>
        </div>

        <!-- Columna 3: Necesidades Educativas -->
        <div class="col-12 col-md-4 d-none formulario-columna" id="columna-4">
            <div class="form-group">
                <label asp-for="TipoNecesidad">Tipo de Necesidad Educativa Especial</label>
                <select asp-for="TipoNecesidad" class="form-control">
                    <option value="">Seleccione...</option>
                    <option value="discapacidad">Discapacidad</option>
                    <option value="trastorno">Trastorno del Aprendizaje</option>
                    <option value="dificultades">Dificultades de Aprendizaje</option>
                    <option value="otro">Otro</option>
                </select>
                <span asp-validation-for="TipoNecesidad" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="DescripcionNecesidad">Descripción de la Necesidad Educativa Especial</label>
                <textarea asp-for="DescripcionNecesidad" class="form-control" rows="4"></textarea>
                <span asp-validation-for="DescripcionNecesidad" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label>¿Tiene alguna condición médica asociada?</label>
                <div>
                    <input type="checkbox" asp-for="CondicionMedica" /> <label> Sí</label>
                </div>
                <span asp-validation-for="CondicionMedica" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label>¿Requiere Adaptaciones Especiales?</label>
                <div>
                    <input type="checkbox" asp-for="RequiereAdaptaciones" /> <label> Sí</label>
                </div>
                <span asp-validation-for="RequiereAdaptaciones" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label>¿Necesita asistencia adicional en el aula?</label>
                <div>
                    <input type="checkbox" asp-for="AsistenciaAdicional" /> <label> Sí</label>
                </div>
                <span asp-validation-for="AsistenciaAdicional" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="ApoyoAdicional">Descripción de otro apoyo necesario</label>
                <textarea asp-for="ApoyoAdicional" class="form-control" rows="4"></textarea>
                <span asp-validation-for="ApoyoAdicional" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="MedicoEspecialista">Médico Especialista</label>
                <input asp-for="MedicoEspecialista" class="form-control" />
                <span asp-validation-for="MedicoEspecialista" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="TratamientoTerapia">Tratamiento o Terapia Requerida</label>
                <input asp-for="TratamientoTerapia" class="form-control" />
                <span asp-validation-for="TratamientoTerapia" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="FechaDiagnostico">Fecha de Diagnóstico</label>
                <input asp-for="FechaDiagnostico" class="form-control" type="date" />
                <span asp-validation-for="FechaDiagnostico" class="text-danger"></span>
            </div>
        </div>

        <!-- Texto informativo -->
        <div class="col-12">
            <p>
                ¿Se considera usted indígena?
                <br />
                La pertenencia a un pueblo indígena u originario se realiza con el fin de desarrollar proyectos específicos para ésta población...
            </p>
        </div>

        <!-- Carrera -->
        <div class="col-12">
            <h1>Carrera</h1>
            <h4>Buscar carrera universitaria</h4>

            <div class="form-group formulario-educativo">
                <label asp-for="UniversidadId">Seleccione el centro educativo:</label>
                <select asp-for="UniversidadId" class="form-control" asp-items="ViewBag.Universidad">
                    <option value="">-- Seleccione --</option>
                </select>
                <span asp-validation-for="UniversidadId" class="text-danger"></span>
            </div>



            <div class="form-group">
                <label asp-for="NombreCarrera">Nombre Carrera</label>
                <input asp-for="NombreCarrera" class="form-control" />
                <span asp-validation-for="NombreCarrera" class="text-danger"></span>
            </div>

            <div class="form-group formulario-educativo">
                <label asp-for="MateriaId">Seleccione la materia:</label>
                <select asp-for="MateriaId" class="form-control" asp-items="ViewBag.Materia">
                    <option value="">-- Seleccione --</option>
                </select>
                <span asp-validation-for="MateriaId" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="NivelAcademico">Nivel Académico</label>
                <input asp-for="NivelAcademico" class="form-control" />
                <span asp-validation-for="NivelAcademico" class="text-danger"></span>
            </div>
        </div>
        <!--input para el archivo-->
        <div class="form-group col-12">
            <label for="ArchivoSubido">Subir archivo (PDF, DOCX, JPG, PNG):</label>
            <input asp-for="ArchivoSubido" type="file"  class="form-control" required />
        </div>
        <!-- Botón Final -->
        <div class="form-group col-12">
            <input type="submit" value="Crear" class="btn btn-primary" />
        </div>
    </div>
</form>

<div>
    <a asp-action="Index">Volver a la lista</a>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script src="~/js/formulario.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>

        $(document).ready(function () {
            // Oculta columna-4 al inicio
            $('#columna-4').addClass('d-none');

            // Control de navegación por tabs con validación
            $('#pills-tab a').on('click', function (e) {
                var tabId = $(this).attr('id');

               // Si se intenta ir a otro paso sin completar paso 1
                if (tabId !== 'pills-step-1-tab') {
                    if (!validarPaso1()) {
                        e.preventDefault(); // Bloquea cambio de tab;
                        return;
                    }
                }

                // Lógica para mostrar columnas según el tab
                if (tabId === 'pills-step-2-tab') {
                    $('#columna-4').removeClass('d-none'); // Muestra columna-4
                    $('#columna-4').insertBefore('#columna-3'); // Reorganiza columna-4 antes de columna-3
                    $('#columna-3').addClass('d-none'); // Oculta columna-3
                }

                if (tabId === 'pills-step-1-tab') {
                    $('#columna-3').removeClass('d-none'); // Muestra columna-3
                    $('#columna-4').addClass('d-none'); // Oculta columna-4
                }
            });


            // Dispara el tab inicial al cargar
            $('#pills-step-1-tab').trigger('click');

            // Función para validar campos requeridos del paso 1
            function validarPaso1() {
                var valid = true;

                // Recorre todos los campos con required dentro de #step-1
                $('#step-1 [required]').each(function () {
                    if (!$(this).val()) {
                        $(this).addClass('is-invalid'); // Clase de Bootstrap para error visual
                        $(this).next('span').text('Este campo es obligatorio'); // Muestra mensaje de error
                        valid = false;
                    } else {
                        $(this).removeClass('is-invalid'); // Limpia error visual
                        $(this).next('span').text(''); // Limpia mensaje de error
                    }
                });

                return valid;
            }
        });


    </script>


   
}
